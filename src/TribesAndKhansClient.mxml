<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" 
			   xmlns:windows="com.uralys.tribes.windows.*" 
			   creationComplete="init()">
	
	<fx:Declarations>
		<s:Move id="hidedisplaymessage" target="{displayMessage}" yTo="-50"/>
		<s:Move id="showdisplaymessage" target="{displayMessage}" yTo="0"/>
		<s:Move id="hidereports" target="{reportsWindow}" yTo="-400"/>
		<s:Move id="showreports" target="{reportsWindow}" yTo="120"/>
		<s:Move id="hideconflicts" target="{conflictsWindow}" yTo="-400"/>
		<s:Move id="showconflicts" target="{conflictsWindow}" yTo="120"/>
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import com.uralys.tribes.commons.Session;
			import com.uralys.tribes.core.Pager;
			import com.uralys.tribes.pages.Login;
			import com.uralys.tribes.pages.Map;
			
			import mx.core.FlexGlobals;
			
			private function init():void{
				if(url == "http://localhost:8888/webresources/flex/TribesAndKhansClient.swf")
					Session.isLocal = true;
				
				Session.APPLICATION_WIDTH = FlexGlobals.topLevelApplication.width;
				
				initBlazeDS();
				Pager.getInstance().window = window;
				Pager.getInstance().goToPage(Login);
			}

			// parfois le mapping flex-java n'est pas fait au premier appel, mais au 2e seulement..
			// donc on force le mapping a l'avance pour que ca marche des le premier appel
			import flash.net.registerClassAlias;
			import com.uralys.tribes.entities.Game;
			import com.uralys.tribes.entities.Player;
			import com.uralys.tribes.entities.City;
			import com.uralys.tribes.entities.Army;
			import com.uralys.tribes.entities.Equipment;
			import com.uralys.tribes.entities.Conflict;
			import com.uralys.tribes.entities.MoveConflict;
			private function initBlazeDS():void{
				registerClassAlias("com.uralys.tribes.entities.Game", Game);
				registerClassAlias("com.uralys.tribes.entities.Player", Player);
				registerClassAlias("com.uralys.tribes.entities.City", City);
				registerClassAlias("com.uralys.tribes.entities.Army", Army);
				registerClassAlias("com.uralys.tribes.entities.Equipment", Equipment);
				registerClassAlias("com.uralys.tribes.entities.Conflict", Conflict);
				registerClassAlias("com.uralys.tribes.entities.MoveConflict", MoveConflict);
			}
			
			//-----------------------------------------------------------------------//
			
			public function message(message:String, time:int):void {
				displayMessage.message = message;
				displayMessage.time = time;
				displayMessage.showMessage();
			}

			public function showReports(report:String):void {
				reportsWindow.area.text = report;
				showreports.play();
			}

			public function createConflicts():void {
				conflictsWindow.initWindow();
				if(Session.currentPlayer.conflicts.length > 0)
					showconflicts.play();
			}

			//-----------------------------------------------------------------------//
			
		]]>
	</fx:Script>
	
	<s:HGroup width="100%" horizontalAlign="center">
		<mx:Image source="../images/fond.jpg" width="100%" height="100%" alpha="0.45"/>
	</s:HGroup>
	<!--
	<mx:Image source="../images/epee.png" left="0" top="28"/>
	<mx:Image source="../images/bouclier.png" right="-10" bottom="50"/>
	-->
	
	<s:VGroup width="100%" height="100%" paddingTop="3" paddingBottom="3">
		
		<!-- header -->
		<s:HGroup width="100%">
			<mx:Spacer width="100%"/>
			<s:Label text="{Session.profil ? 'Logged as : '+ Session.uralysProfile.email : 'Please log in'}"
					 color="#222299"/>
		</s:HGroup>	
		<mx:HRule width="100%" chromeColor="#222299"/>
		
		
		<!-- content -->
		<s:Group id="window" width="100%" height="100%"/>
		

		<!-- footer -->
		<mx:HRule width="100%" chromeColor="#222299"/>
		<s:HGroup width="100%" horizontalAlign="center">
			<mx:Image source="../images/logos/uralysminilogo.png" 
					  x="65" bottom="2"
					  click="navigateToURL(new URLRequest('http://www.uralys.com'), '_new');"/>
			<mx:Spacer width="10%"/>
			<s:Label text=" Aller sur le Forum"
					 click="navigateToURL(new URLRequest('http://www.uralys.com/forumTAK'), '_new');"
					 color="#222299"/>
			<mx:Spacer width="20%"/>
			<s:Label text=" Tribes And Khans 2011   -    version {Session.VERSION}" 
					 color="#222299"/>
		</s:HGroup>	
	</s:VGroup>
	
	<!-- ========================================================================== -->
	<!-- windows -->
	
	<windows:SimpleMessageCanvas id="displayMessage" x="{(Session.APPLICATION_WIDTH - 600) / 2}" y="-50"/>
	<windows:ReportsWindow id="reportsWindow" x="{(Session.APPLICATION_WIDTH - 450) / 2}" y="-400"/>
	<windows:ConflictsWindow id="conflictsWindow" x="{(Session.APPLICATION_WIDTH - 450) / 2}" y="-400"/>
	
	<!-- ========================================================================== -->
	
	<fx:Style source="resources/style/style.css"/> 
	
	<!-- ========================================================================== -->
	
</s:Application>
